# Test Case Details - Rush Order Functionality

## Test Case Specifications

| Test Case ID | Test Case Name                                                         | Description                                                   | Unit Under Test                     | Input Data                                                                                      | Expected Output                                           | Actual Output                                                                                         |
|--------------|------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------|--------------------------------------------------------------------------------------------------|-----------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| 1            | should be defined - calculateRushSurcharge                            | Kiểm tra hàm calculateRushSurcharge được định nghĩa           | calculateRushSurcharge function     | N/A                                                                                              | Function được định nghĩa và có thể gọi                    | Function tồn tại và có thể gọi                                                                       |
| 2            | should return 0 when isRushOrder is false                             | Trả về 0 khi không phải rush order                           | calculateRushSurcharge              | items: [{quantity: 1, priceAtAdd: 10}], isRushOrder: false                                     | 0                                                         | 0                                                                                                     |
| 3            | should calculate correct surcharge for single item                    | Tính phí rush delivery cho 1 sản phẩm                        | calculateRushSurcharge              | items: [{quantity: 1, priceAtAdd: 10, product: {isAvailableRush: true}}], isRushOrder: true   | 4.00                                                      | 4.00                                                                                                  |
| 4            | should calculate correct surcharge for multiple items                 | Tính phí rush delivery cho nhiều sản phẩm                    | calculateRushSurcharge              | items: [{quantity: 2, priceAtAdd: 10}, {quantity: 1, priceAtAdd: 15}], isRushOrder: true      | 12.00 (3 items × $4)                                     | 12.00                                                                                                 |
| 5            | should throw error for non-Hanoi address                              | Ném lỗi khi địa chỉ không phải Hà Nội                        | calculateRushSurcharge              | items: [...], isRushOrder: true, address: {city: "Ho Chi Minh"}                               | Error: "Rush delivery is only available in Hanoi"        | Error được ném với message chính xác                                                                 |
| 6            | should throw error for ineligible products                            | Ném lỗi khi sản phẩm không đủ điều kiện rush                | calculateRushSurcharge              | items: [{product: {isAvailableRush: false}}], isRushOrder: true                               | Error: "Some items are not eligible for rush delivery"   | Error được ném với message chính xác                                                                 |
| 7            | should handle undefined product data gracefully                       | Xử lý dữ liệu sản phẩm undefined một cách an toàn            | calculateRushSurcharge              | items: [{quantity: 1, priceAtAdd: 10, product: undefined}], isRushOrder: true                 | 4.00 (default to eligible)                               | 4.00                                                                                                  |
| 8            | should validate Hanoi address variations correctly                    | Xác thực các biến thể địa chỉ Hà Nội                         | isHanoiAddress function             | city: "Hanoi", "Ha Noi", "HN", "hà nội"                                                       | true cho tất cả các biến thể                             | true                                                                                                  |
| 9            | should reject non-Hanoi addresses                                     | Từ chối địa chỉ không phải Hà Nội                            | isHanoiAddress function             | city: "Ho Chi Minh", "Da Nang", "Can Tho"                                                     | false cho tất cả                                         | false                                                                                                 |
| 10           | should handle empty or null city input                                | Xử lý input thành phố rỗng hoặc null                         | isHanoiAddress function             | city: "", null, undefined                                                                      | false cho tất cả                                         | false                                                                                                 |
| 11           | should normalize Vietnamese accents correctly                         | Chuẩn hóa dấu tiếng Việt chính xác                           | isHanoiAddress function             | city: "Hà Nội", "hà nội", "HÀ NỘI"                                                            | true cho tất cả                                          | true                                                                                                  |
| 12           | should validate all cart items are rush eligible                      | Xác thực tất cả sản phẩm trong giỏ đủ điều kiện rush         | validateProductsForRush             | products: [{isAvailableRush: true}, {isAvailableRush: true}]                                   | {allEligible: true, ineligibleProducts: []}              | {allEligible: true, ineligibleProducts: []}                                                          |
| 13           | should identify ineligible products correctly                         | Xác định sản phẩm không đủ điều kiện chính xác               | validateProductsForRush             | products: [{title: "Book1", isAvailableRush: false}]                                          | {allEligible: false, ineligibleProducts: ["Book1"]}      | {allEligible: false, ineligibleProducts: ["Book1"]}                                                  |
| 14           | should handle mixed eligible and ineligible products                  | Xử lý hỗn hợp sản phẩm đủ và không đủ điều kiện              | validateProductsForRush             | products: [{title: "Book1", isAvailableRush: true}, {title: "Book2", isAvailableRush: false}] | {allEligible: false, ineligibleProducts: ["Book2"]}      | {allEligible: false, ineligibleProducts: ["Book2"]}                                                  |
| 15           | should default to eligible for undefined isAvailableRush             | Mặc định đủ điều kiện khi isAvailableRush undefined          | validateProductsForRush             | products: [{title: "Book1", isAvailableRush: undefined}]                                      | {allEligible: true, ineligibleProducts: []}              | {allEligible: true, ineligibleProducts: []}                                                          |
| 16           | should calculate total with rush surcharge included                   | Tính tổng tiền bao gồm phí rush delivery                     | calculateOrderTotal                 | items: [...], isRushOrder: true, address: {city: "Hanoi"}                                     | {total: subtotal + shipping + rush + tax}                | Tổng tiền chính xác bao gồm phí rush                                                                 |
| 17           | should calculate total without rush surcharge when not rush order     | Tính tổng tiền không bao gồm phí rush khi không rush order   | calculateOrderTotal                 | items: [...], isRushOrder: false                                                              | {total: subtotal + shipping + tax, rushSurcharge: 0}     | Tổng tiền không có phí rush                                                                          |
| 18           | should include rush surcharge in breakdown                            | Bao gồm phí rush trong chi tiết hóa đơn                      | calculateOrderTotal                 | items: [...], isRushOrder: true                                                               | {rushSurcharge: 4.00, ...otherFields}                    | Chi tiết hóa đơn có rushSurcharge                                                                    |
| 19           | should validate rush order with valid address and products            | Xác thực rush order với địa chỉ và sản phẩm hợp lệ           | validateRushOrder                   | cartItems: [...eligible], address: {city: "Hanoi"}                                           | {canRushOrder: true, message: "All items eligible"}      | Validation thành công                                                                                |
| 20           | should reject rush order with invalid address                         | Từ chối rush order với địa chỉ không hợp lệ                  | validateRushOrder                   | cartItems: [...], address: {city: "Ho Chi Minh"}                                             | {canRushOrder: false, message: "Only available in Hanoi"} | Validation thất bại với message chính xác                                                           |
| 21           | should reject rush order with ineligible products                     | Từ chối rush order với sản phẩm không đủ điều kiện           | validateRushOrder                   | cartItems: [{product: {isAvailableRush: false}}], address: {city: "Hanoi"}                   | {canRushOrder: false, ineligibleItems: [...]}            | Validation thất bại với danh sách sản phẩm không đủ điều kiện                                       |
| 22           | should provide detailed error messages                                | Cung cấp thông báo lỗi chi tiết                              | validateRushOrder                   | Various invalid inputs                                                                         | Detailed error messages for each case                    | Messages chính xác cho từng trường hợp                                                              |
| 23           | should transform product data with isAvailableRush field              | Transform dữ liệu sản phẩm với field isAvailableRush         | transformProductData                | productData: {title: "Book", isAvailableRush: false}                                         | {title: "Book", isAvailableRush: false, ...otherFields}  | Dữ liệu được transform với đầy đủ fields                                                            |
| 24           | should default isAvailableRush to true for backward compatibility     | Mặc định isAvailableRush = true cho tương thích ngược        | transformProductData                | productData: {title: "Book"} (no isAvailableRush field)                                      | {title: "Book", isAvailableRush: true, ...otherFields}   | isAvailableRush được set mặc định true                                                              |
| 25           | should preserve all product fields during transformation              | Bảo toàn tất cả fields sản phẩm khi transform                | transformProductData                | productData: {title: "Book", price: 10, stock: 5, isAvailableRush: true}                    | All fields preserved in output                           | Tất cả fields được bảo toàn                                                                         |
| 26           | should disable rush delivery for ineligible cart items               | Vô hiệu hóa rush delivery cho sản phẩm không đủ điều kiện    | ShippingAddressForm component       | cartItems: [{product: {isAvailableRush: false}}]                                             | Rush delivery checkbox disabled                          | Checkbox bị vô hiệu hóa                                                                             |
| 27           | should enable rush delivery for eligible items in Hanoi              | Kích hoạt rush delivery cho sản phẩm đủ điều kiện ở Hà Nội   | ShippingAddressForm component       | cartItems: [{product: {isAvailableRush: true}}], address: {city: "Hanoi"}                   | Rush delivery checkbox enabled                           | Checkbox được kích hoạt                                                                             |
| 28           | should auto-disable rush delivery when conditions change             | Tự động vô hiệu hóa rush delivery khi điều kiện thay đổi     | ShippingAddressForm component       | Change address from Hanoi to Ho Chi Minh                                                     | Rush delivery automatically unchecked                    | Checkbox tự động bỏ chọn                                                                            |
| 29           | should display correct tooltip messages                              | Hiển thị tooltip messages chính xác                          | ShippingAddressForm component       | Various states (address invalid, products ineligible)                                        | Appropriate tooltip messages                             | Messages chính xác cho từng trạng thái                                                              |
| 30           | should create order with rush delivery successfully                  | Tạo đơn hàng với rush delivery thành công                    | OrdersService.createOrderFromCart   | cartItems: [...eligible], isRushOrder: true, address: {city: "Hanoi"}                       | Order created with rush delivery flag                    | Đơn hàng được tạo với isRushOrder = true                                                            |
| 31           | should reject order creation with invalid rush delivery setup        | Từ chối tạo đơn hàng với thiết lập rush delivery không hợp lệ | OrdersService.createOrderFromCart   | cartItems: [...ineligible], isRushOrder: true                                                | BadRequestException thrown                               | Exception được ném với message phù hợp                                                              |
| 32           | should validate products during order creation                       | Xác thực sản phẩm trong quá trình tạo đơn hàng               | OrdersService.createOrderFromCart   | cartItems with mixed eligibility                                                             | Validation errors for ineligible products               | Lỗi validation cho sản phẩm không đủ điều kiện                                                     |
| 33           | should calculate correct pricing during order creation               | Tính giá chính xác trong quá trình tạo đơn hàng              | OrdersService.createOrderFromCart   | cartItems: [...], isRushOrder: true                                                          | Order total includes rush surcharge                     | Tổng tiền đơn hàng bao gồm phí rush                                                                 |
| 34           | should update product isAvailableRush field successfully             | Cập nhật field isAvailableRush của sản phẩm thành công       | AdminProductsService.update         | productId: "123", updateData: {isAvailableRush: false}                                       | Product updated with new rush availability               | Sản phẩm được cập nhật với trạng thái rush mới                                                      |
| 35           | should validate admin permissions for product updates                | Xác thực quyền admin cho việc cập nhật sản phẩm              | AdminProductsService.update         | userId: "admin123", productId: "123", updateData: {...}                                      | Update successful with proper authorization              | Cập nhật thành công với xác thực quyền                                                              |
| 36           | should handle product update errors gracefully                       | Xử lý lỗi cập nhật sản phẩm một cách graceful                | AdminProductsService.update         | Invalid productId or updateData                                                               | Appropriate error responses                              | Phản hồi lỗi phù hợp                                                                                |
