<html>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>Thanh to√°n th√†nh c√¥ng</title>
    <style>
      .btn-refund {
        background: linear-gradient(45deg, #dc3545, #c82333);
        color: white;
        padding: 14px 28px;
        text-decoration: none;
        border-radius: 8px;
        display: inline-block;
        margin: 10px;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-family: Arial, sans-serif;
      }
      .btn-refund:hover {
        background: linear-gradient(45deg, #c82333, #bd2130);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4);
      }
      .btn-view {
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
        padding: 14px 28px;
        text-decoration: none;
        border-radius: 8px;
        display: inline-block;
        margin: 10px;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        transition: all 0.3s ease;
      }
      .btn-view:hover {
        background: linear-gradient(45deg, #0056b3, #004085);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 123, 255, 0.4);
      }
      .product-item {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 15px;
        margin: 10px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .product-info {
        flex: 1;
      }
      .product-price {
        text-align: right;
        font-weight: bold;
        color: #28a745;
      }
      .transaction-info {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }
      .summary-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }
      .summary-table th,
      .summary-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      .summary-table th {
        background: #f8f9fa;
        font-weight: bold;
        color: #495057;
      }
      .total-row {
        background: #28a745;
        color: white;
        font-weight: bold;
        font-size: 18px;
      }
    </style>
  </head>
  <body
    style='font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 700px; margin: 0 auto; padding: 20px; background-color: #f4f4f4;'
  >

    <!-- Header -->
    <div
      style='text-align: center; margin-bottom: 30px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);'
    >
      <h1 style='color: #28a745; margin: 0; font-size: 32px;'>‚úÖ Thanh to√°n
        th√†nh c√¥ng!</h1>
      <p style='margin: 10px 0 0 0; color: #666; font-size: 16px;'>C·∫£m ∆°n b·∫°n ƒë√£
        mua s·∫Øm t·∫°i Online Bookstore</p>
    </div>

    <!-- Order Summary -->
    <div
      style='background: white; border-radius: 12px; padding: 30px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);'
    >
      <h2
        style='color: #333; margin-top: 0; border-bottom: 3px solid #28a745; padding-bottom: 15px; font-size: 24px;'
      >
        üìã Th√¥ng tin ƒë∆°n h√†ng
      </h2>

      <div
        style='background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;'
      >
        <p style='margin: 0 0 10px 0; font-size: 18px;'>Ch√†o b·∫°n,</p>
        <p style='margin: 0; font-size: 16px;'>
          ƒê∆°n h√†ng
          <strong style='color: #007bff;'>#{{order.orderNumber}}</strong>
          ƒë√£ ƒë∆∞·ª£c thanh to√°n th√†nh c√¥ng qua VNPay.
          <br />Th·ªùi gian:
          <strong>{{order.createdAt}}</strong>
        </p>
      </div>

      <table class='summary-table'>
        <tr>
          <th>M√£ ƒë∆°n h√†ng</th>
          <td><strong
              style='color: #007bff;'
            >{{order.orderNumber}}</strong></td>
        </tr>
        <tr>
          <th>Tr·∫°ng th√°i ƒë∆°n h√†ng</th>
          <td>
            <span
              style='background: #28a745; color: white; padding: 6px 12px; border-radius: 20px; font-size: 14px;'
            >
              {{order.status}}
            </span>
          </td>
        </tr>
        <tr>
          <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>
          <td><strong>VNPay</strong></td>
        </tr>
        <tr>
          <th>Th·ªùi gian ƒë·∫∑t h√†ng</th>
          <td>{{order.createdAt}}</td>
        </tr>
        {{#if order.receivedAt}}
          <tr>
            <th>Th·ªùi gian thanh to√°n</th>
            <td>{{order.receivedAt}}</td>
          </tr>
        {{/if}}
      </table>
    </div>

    <!-- Product Details -->
    {{#if order.items}}
      <div
        style='background: white; border-radius: 12px; padding: 30px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);'
      >
        <h2
          style='color: #333; margin-top: 0; border-bottom: 3px solid #007bff; padding-bottom: 15px; font-size: 24px;'
        >
          üìö Chi ti·∫øt s·∫£n ph·∫©m
        </h2>

        {{#each order.items}}
          <div class='product-item'>
            <div class='product-info'>
              <h4 style='margin: 0 0 8px 0; color: #333; font-size: 18px;'>üìñ
                {{this.title}}</h4>
              {{#if this.author}}
                <p
                  style='margin: 0 0 8px 0; color: #666; font-style: italic;'
                >T√°c gi·∫£: {{this.author}}</p>
              {{/if}}
              <div style='color: #666; font-size: 14px;'>
                <span
                  style='background: #e9ecef; padding: 4px 8px; border-radius: 4px; margin-right: 10px;'
                >
                  S·ªë l∆∞·ª£ng:
                  <strong>{{this.quantity}}</strong>
                </span>
                <span
                  style='background: #fff3cd; padding: 4px 8px; border-radius: 4px;'
                >
                  ƒê∆°n gi√°:
                  <strong>{{formatCurrency this.price}} VNƒê</strong>
                </span>
                {{#if this.discount}}
                  <span
                    style='background: #d4edda; padding: 4px 8px; border-radius: 4px; margin-left: 10px;'
                  >
                    Gi·∫£m gi√°:
                    <strong>{{this.discount}}%</strong>
                  </span>
                {{/if}}
              </div>
            </div>
            <div class='product-price'>
              <div style='font-size: 18px; color: #28a745;'>
                {{formatCurrency (multiply this.price this.quantity)}}
                VNƒê
              </div>
            </div>
          </div>
        {{/each}}

        <!-- Order Totals -->
        <div
          style='border-top: 2px solid #eee; margin-top: 20px; padding-top: 20px;'
        >
          <table style='width: 100%; font-size: 16px;'>
            <tr>
              <td style='padding: 8px 0; text-align: right;'><strong>T·∫°m t√≠nh:</strong></td>
              <td
                style='padding: 8px 0; text-align: right; width: 150px;'
              >{{formatCurrency order.subtotal}} VNƒê</td>
            </tr>
            {{#if order.tax}}
              <tr>
                <td style='padding: 8px 0; text-align: right;'><strong
                  >Thu·∫ø:</strong></td>
                <td style='padding: 8px 0; text-align: right;'>{{formatCurrency
                    order.tax
                  }}
                  VNƒê</td>
              </tr>
            {{/if}}
            {{#if order.shippingCost}}
              <tr>
                <td style='padding: 8px 0; text-align: right;'><strong>Ph√≠ v·∫≠n
                    chuy·ªÉn:</strong></td>
                <td style='padding: 8px 0; text-align: right;'>{{formatCurrency
                    order.shippingCost
                  }}
                  VNƒê</td>
              </tr>
            {{/if}}
            {{#if order.discount}}
              <tr>
                <td
                  style='padding: 8px 0; text-align: right; color: #dc3545;'
                ><strong>Gi·∫£m gi√°:</strong></td>
                <td
                  style='padding: 8px 0; text-align: right; color: #dc3545;'
                >-{{formatCurrency order.discount}} VNƒê</td>
              </tr>
            {{/if}}
            <tr style='border-top: 2px solid #28a745;'>
              <td
                style='padding: 15px 0; text-align: right; font-size: 20px; font-weight: bold; color: #28a745;'
              >T·ªîNG C·ªòNG:</td>
              <td
                style='padding: 15px 0; text-align: right; font-size: 24px; font-weight: bold; color: #28a745;'
              >
                {{formatCurrency order.total}}
                VNƒê
              </td>
            </tr>
          </table>
        </div>
      </div>
    {{/if}}

    <!-- Transaction Information -->
    {{#if payment}}
      <div
        style='background: white; border-radius: 12px; padding: 30px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);'
      >
        <h2
          style='color: #333; margin-top: 0; border-bottom: 3px solid #17a2b8; padding-bottom: 15px; font-size: 24px;'
        >
          üí≥ Th√¥ng tin giao d·ªãch
        </h2>

        <div class='transaction-info'>
          <table class='summary-table'>
            <tr>
              <th>M√£ thanh to√°n</th>
              <td><strong style='color: #007bff;'>{{payment.id}}</strong></td>
            </tr>
            {{#if payment.transactionId}}
              <tr>
                <th>M√£ giao d·ªãch VNPay</th>
                <td><strong
                    style='color: #28a745;'
                  >{{payment.transactionId}}</strong></td>
              </tr>
            {{/if}}
            <tr>
              <th>Tr·∫°ng th√°i thanh to√°n</th>
              <td>
                <span
                  style='background: #28a745; color: white; padding: 6px 12px; border-radius: 20px; font-size: 14px;'
                >
                  {{payment.status}}
                </span>
              </td>
            </tr>
            <tr>
              <th>S·ªë ti·ªÅn ƒë√£ thanh to√°n</th>
              <td><strong
                  style='color: #28a745; font-size: 18px;'
                >{{formatCurrency payment.amount}} VNƒê</strong></td>
            </tr>
            {{#if payment.bankCode}}
              <tr>
                <th>Ng√¢n h√†ng</th>
                <td><strong>{{payment.bankCode}}</strong></td>
              </tr>
            {{/if}}
            {{#if payment.completedAt}}
              <tr>
                <th>Th·ªùi gian ho√†n t·∫•t</th>
                <td>{{payment.completedAt}}</td>
              </tr>
            {{/if}}
          </table>
        </div>
      </div>
    {{/if}}

    <!-- Shipping Address -->
    {{#if order.shippingAddress}}
      <div
        style='background: white; border-radius: 12px; padding: 30px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);'
      >
        <h2
          style='color: #333; margin-top: 0; border-bottom: 3px solid #ffc107; padding-bottom: 15px; font-size: 24px;'
        >
          üöö ƒê·ªãa ch·ªâ giao h√†ng
        </h2>

        <div
          style='background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 8px;'
        >
          <p style='margin: 0 0 8px 0; font-size: 16px;'><strong
            >{{order.shippingAddress.fullName}}</strong></p>
          <p style='margin: 0 0 8px 0;'>üì± {{order.shippingAddress.phone}}</p>
          <p style='margin: 0;'>üìç
            {{order.shippingAddress.address}},
            {{order.shippingAddress.city}}</p>
        </div>
      </div>
    {{/if}}

    <!-- Action Buttons -->
    <div
      style='text-align: center; margin: 40px 0; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);'
    >
      <h3 style='margin-top: 0; color: #333; font-size: 20px;'>C√°c thao t√°c kh·∫£
        d·ª•ng</h3>

      <a href='{{orderViewUrl}}' class='btn-view'>
        üëÅÔ∏è Xem chi ti·∫øt ƒë∆°n h√†ng
      </a>

      <!-- Direct Refund Link -->
      <a
        href='{{refundApiUrl}}'
        class='btn-refund'
        onclick='return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën y√™u c·∫ßu ho√†n ti·ªÅn cho ƒë∆°n h√†ng n√†y?\n\nS·ªë ti·ªÅn s·∫Ω ho√†n: {{formatCurrency
          payment.amount
        }} VNƒê\nTh·ªùi gian x·ª≠ l√Ω: 3-5 ng√†y l√†m vi·ªác")'
      >
        üí∞ Y√™u c·∫ßu ho√†n ti·ªÅn
      </a>
    </div>

    <!-- Important Notes -->
    <div
      style='background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 8px; margin: 25px 0;'
    >
      <h4 style='margin: 0 0 15px 0; color: #856404;'>üìù L∆∞u √Ω quan tr·ªçng:</h4>
      <ul style='margin: 0; padding-left: 20px; color: #856404;'>
        <li>B·∫°n c√≥ th·ªÉ y√™u c·∫ßu ho√†n ti·ªÅn trong v√≤ng
          <strong>30 ng√†y</strong>
          k·ªÉ t·ª´ ng√†y thanh to√°n</li>
        <li>Qu√° tr√¨nh ho√†n ti·ªÅn s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω qua VNPay v√† c√≥ th·ªÉ m·∫•t 3-5 ng√†y
          l√†m vi·ªác</li>
        <li>Vui l√≤ng l∆∞u email n√†y ƒë·ªÉ ti·ªán tra c·ª©u v√† theo d√µi ƒë∆°n h√†ng</li>
        <li>M·ªçi th·∫Øc m·∫Øc vui l√≤ng li√™n h·ªá b·ªô ph·∫≠n CSKH: support@bookstore.com</li>
        <li>Hotline: 1900-1000 (8:00 - 22:00 h√†ng ng√†y)</li>
      </ul>
    </div>

    <!-- Footer -->
    <hr style='border: none; border-top: 1px solid #eee; margin: 40px 0;' />

    <div
      style='text-align: center; color: #888; font-size: 14px; background: white; padding: 20px; border-radius: 8px;'
    >
      <p style='margin: 0 0 10px 0; font-weight: bold;'>¬©
        {{currentYear}}
        Online Bookstore</p>
      <p style='margin: 0;'>üè™ C·ª≠a h√†ng s√°ch tr·ª±c tuy·∫øn h√†ng ƒë·∫ßu Vi·ªát Nam</p>
      <p style='margin: 10px 0 0 0; font-size: 12px;'>
        üìß support@bookstore.com | üì± 1900-1000 | üåê www.bookstore.com
      </p>
    </div>

  </body>
</html>