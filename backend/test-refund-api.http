### Test Refund API - VNPay Integration

@baseUrl = http://localhost:3001/api
@orderId = 685bebd9886e4d3ff1b904e3
@paymentId = 685bee2500c8004cc96ed25d

### 1. Ki·ªÉm tra order hi·ªán t·∫°i
GET {{baseUrl}}/orders/{{orderId}}
Authorization: Bearer YOUR_JWT_TOKEN

### 2. Ki·ªÉm tra payment hi·ªán t·∫°i
GET {{baseUrl}}/payments/{{paymentId}}

### 3. L·∫•y debug tokens cho order
GET {{baseUrl}}/orders/debug-tokens/{{orderId}}

### 4. Test order view tr∆∞·ªõc khi refund (copy viewToken t·ª´ step 3)
GET {{baseUrl}}/orders/view/VIEW_TOKEN_FROM_STEP_3

### 5. Th·ª±c hi·ªán refund request (copy refundToken t·ª´ step 3)
POST {{baseUrl}}/orders/refund/REFUND_TOKEN_FROM_STEP_3
Content-Type: application/json

{
  "reason": "Kh√¥ng c√≤n c·∫ßn s√°ch n√†y n·ªØa. Mu·ªën ƒë·ªïi sang s√°ch kh√°c."
}

### 6. Ki·ªÉm tra payment status sau refund
GET {{baseUrl}}/payments/{{paymentId}}

### 7. Ki·ªÉm tra order status sau refund
GET {{baseUrl}}/orders/{{orderId}}
Authorization: Bearer YOUR_JWT_TOKEN

### 8. Test v·ªõi payment kh√°c (n·∫øu c√≥)
GET {{baseUrl}}/payments

### 9. Test refund tr·ª±c ti·∫øp qua PaymentsController (n·∫øu c√≥ endpoint)
POST {{baseUrl}}/payments/{{paymentId}}/refund
Content-Type: application/json

{
  "reason": "Test refund qua payments controller"
}

### 10. Test danh s√°ch transactions c·ªßa payment
GET {{baseUrl}}/payments/{{paymentId}}/transactions

### H∆Ø·ªöNG D·∫™N TEST REFUND:

### B∆∞·ªõc 1: Chu·∫©n b·ªã
# - ƒê·∫£m b·∫£o c√≥ order ƒë√£ thanh to√°n th√†nh c√¥ng (status: RECEIVED)
# - ƒê·∫£m b·∫£o c√≥ payment v·ªõi status: COMPLETED
# - Order ph·∫£i trong v√≤ng 30 ng√†y (refund window)

### B∆∞·ªõc 2: L·∫•y tokens
# - Ch·∫°y step 3 ƒë·ªÉ l·∫•y viewToken v√† refundToken
# - Copy tokens v√†o step 4 v√† 5

### B∆∞·ªõc 3: Test refund
# - Ch·∫°y step 5 v·ªõi l√Ω do refund
# - Ki·ªÉm tra response c√≥ success: true kh√¥ng

### B∆∞·ªõc 4: Verify results
# - Payment status chuy·ªÉn th√†nh "REFUNDED"
# - Order status chuy·ªÉn th√†nh "REFUNDED"  
# - Email refund confirmation ƒë∆∞·ª£c g·ª≠i

### K·∫æT QU·∫¢ MONG ƒê·ª¢I:

### Response th√†nh c√¥ng:
# {
#   "success": true,
#   "message": "Refund request processed successfully",
#   "refundAmount": 3527250,
#   "orderId": "685bebd9886e4d3ff1b904e3"
# }

### VNPay refund (sandbox s·∫Ω lu√¥n success):
# - VNPay sandbox mode: Refund lu√¥n th√†nh c√¥ng
# - Production: C·∫ßn ki·ªÉm tra th·ª±c t·∫ø v·ªõi ng√¢n h√†ng

### Email refund confirmation:
# - G·ª≠i ƒë·∫øn hungvt0110@outlook.com
# - Subject: "üí∞ Ho√†n ti·ªÅn th√†nh c√¥ng - ƒê∆°n h√†ng #ORDER_NUMBER"
# - N·ªôi dung: Th√¥ng tin ho√†n ti·ªÅn, th·ªùi gian x·ª≠ l√Ω, ng√¢n h√†ng

### DEBUGGING:
### N·∫øu refund fail:
# 1. Ki·ªÉm tra payment status (ph·∫£i l√† COMPLETED)
# 2. Ki·ªÉm tra order status (kh√¥ng ƒë∆∞·ª£c l√† REFUNDED, CANCELED)
# 3. Ki·ªÉm tra refund window (trong 30 ng√†y)
# 4. Xem server logs ƒë·ªÉ debug VNPay refund response 